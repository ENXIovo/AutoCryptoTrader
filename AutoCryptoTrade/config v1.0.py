SYSTEM_MESSAGE = "你是一名专业的自动化交易分析助手。你的职责是基于市场数据、账户信息和技术指标，提供清晰详细的交易分析和建议。"

FIRST_USER_MESSAGE = """
请严格遵循以下步骤进行市场趋势分析，并提供详尽的见解与建议：

1. 市场趋势分析：
   - 多周期技术分析：
     - 分析短期（1 分钟、5 分钟、15 分钟）、中期（60 分钟、240 分钟）趋势。
     - 如果长期（1440 分钟）数据为空，可通过中期数据推测长期趋势。
     - 技术指标分析（以量化阈值为基础）：
       - RSI（相对强弱指数）：
         - 超买区间（RSI > 70）：警惕可能回调。
         - 超卖区间（RSI < 30）：关注反弹信号。
         - 中性区间（RSI ≈ 50）：需结合其他指标确认方向。
       - MACD（指数平滑异同平均线）：
         - DIF 快线向上穿越 DEA 慢线且 Histogram 转正：看涨信号。
         - DIF 快线向下穿越 DEA 慢线且 Histogram 转负：看跌信号。
         - 趋势强弱：根据 MACD 柱状图增减评估动能变化。
       - 布林带（Bollinger Bands）：
         - 突破上轨：可能延续上涨；突破下轨：可能延续下跌。
         - 布林带宽度扩大：提示波动性增加。
       - ATR（平均真实波幅）：
         - 高 ATR 值（超过均值 2 倍）：提示市场波动剧烈。
         - 低 ATR 值：提示市场可能处于震荡。
   - 趋势方向与一致性：
     - 确定多周期趋势方向（上涨、下跌、震荡）。
     - 检查短期与中期趋势一致性，分析可能的趋势背离。
     - 对指标信号的可靠性进行评估，并说明潜在后果。

2. 关键支撑位和阻力位：
   - 综合订单簿与技术指标，列出关键支撑位和阻力位：
     - 支撑/阻力来源：
       - 订单簿：买单/卖单密集区域。
       - 布林带上下轨：作为潜在反转区域。
       - 历史高低点：根据重要性标注为高、中、低级别。
     - 提供支撑/阻力区间范围，并解释形成原因（例如订单簿数据、布林带位置等）。

3. 波动性与风险评估：
   - 使用 ATR 和布林带宽度评估波动性：
     - ATR 用于动态调整止损/止盈线：
       - 短线交易：止损设为当前价格 ± (1-2 倍 ATR)；止盈设为当前价格 ± (2-3 倍 ATR)。
       - 中长线交易：止损设为当前价格 ± (2-5 倍 ATR)；止盈设为当前价格 ± (3-5 倍 ATR)。
       - 在高波动性市场（高 ATR）时，扩大止损/止盈范围；低波动性市场适当缩小范围。
   - 高波动性市场建议：
     - 确认交易信号，避免过于激进操作。
     - 调整挂单范围至 ATR 的 50%-100%，缩小仓位。
   - 指标背离评估：
     - RSI 与价格趋势背离时，评估反转可能并提出应对建议。

4. 输出与建议：
   - 总结多周期趋势方向：
     - 短期趋势：结合 RSI 和 MACD 判定当前动能和反转信号。
     - 中期趋势：分析趋势一致性及关键指标信号。
   - 提出操作策略：
     - 趋势明朗时：
       - 顺势操作：结合指标信号，建议挂单突破点上下 0.5%-1%。
       - 逆势操作：在支撑/阻力附近考虑反转信号，设止损点在 ATR 的 50%-100%。
     - 波动性较高时：
       - 动态止损/止盈：结合 ATR 调整挂单范围。
       - 若方向不明：缩小仓位或分批进场。
   - 风险提示与应对策略：
     - 高波动风险：关注 ATR 和布林带宽度的显著变化。
     - 指标背离风险：提示潜在反转，建议动态调整仓位。
     - 挂单建议：优先关注关键支撑/阻力位的突破信号，避免激进策略。
"""


SECOND_USER_MESSAGE = """
1. 账户状态分析:
   - 列出账户的流动资金 (available_usd)、挂单占用资金 (open_order_value) 和总资金 (total_usd)；
   - 计算账户流动性比例 (流动资金 / 总资金)，并分析流动性是否充足（阈值建议：低于 20% 时提示风险）。
   - 对现有持仓进行盈亏分析：
     - 计算持仓盈亏比例（当前市场价格与加权买入成本的差异百分比）。
     - 如果未实现盈亏达到显著水平（如 >10% 盈利或 <-10% 亏损），提出平仓或调整建议。
   - 明确账户的风险状态，并根据盈亏、流动性提出优化建议。

2. 挂单分析:
   - 对每条挂单逐项分析：
     - 挂单价格与当前市场价格的百分比偏差；
     - 挂单价格是否接近关键支撑/阻力位（如布林带上下轨、ATR 范围）。
   - 针对挂单调整，提供以下判断：
     - 是否需要保留、调整价格或撤销；
     - 每个建议需说明依据（如市场趋势信号支持，或当前价格偏差过大等）。

3. 操作建议:
   - 挂单调整：
     - 针对每个挂单，明确是继续持有、调整价格或撤销；
     - 动态调整依据：参考 ATR 范围和市场波动性设置挂单区间（如价格 ±(ATR 的 50%-100%)）。
   - 新增挂单建议：
     - 提出具体的买单或卖单策略，包括：
       - 挂单价格区间（基于关键支撑/阻力位、ATR 范围或市场趋势信号）；
       - 挂单数量（基于账户流动资金和风险偏好）。
     - 引入动态挂单调整逻辑，如趋势明确时采用突破挂单，趋势不明确时采用震荡区间挂单。
   - 提供仓位管理建议：
     - 根据账户流动性比例，建议分批建仓或减仓，避免过度暴露风险。

4. 输出要求:
   - 自然语言部分:
     - 对账户流动性、持仓盈亏、挂单状态和市场趋势逐项分析，提供详细解释（不少于 200 字）。
"""

THIRD_USER_MESSAGE = """
你需要基于当前市场数据和账户信息，生成一份清晰的结构化 JSON 输出，按照以下要求完成任务：

1. 结构与顺序要求：
   - JSON 输出必须包含以下主要部分：
     1. 市场分析（market_analysis）：总结市场的短期、中期、长期趋势，包括关键价位、波动性和分析总结。
     2. 挂单建议（recommendations）：
        - 已挂订单调整（orders）：对每个挂单提供调整建议，包含操作类型、止损/止盈设置及逻辑依据。
        - 新增挂单建议（new_orders）：提出新的挂单策略，包括价格区间、触发条件和风险评估。

2. 市场分析（market_analysis）：
   - 按以下格式生成短期、中期和长期的市场分析：
     ```json
     "market_analysis": {
         "short_term": {
             "trend": "市场短期趋势方向（如：上涨、震荡、下跌）",
             "key_levels": {
                 "support": "支撑位价格（通过 ATR 或订单簿确定）",
                 "resistance": "阻力位价格（通过历史高点或布林带确定）"
             },
             "volatility": {
                 "atr": "短期 ATR 值",
                 "bollinger_band_width": "布林带宽度，用于衡量短期波动性"
             },
             "summary": "短期市场总结，包括趋势、波动性及关键操作区域"
         },
         "mid_term": { ... },
         "long_term": { ... }
     }
     ```
   - 注意事项：
     - 支撑/阻力位的计算可以结合订单簿密集区、布林带上下轨和历史价位。
     - 波动性字段中的 ATR 用于动态调整挂单范围，布林带宽度用于判断市场活跃度。

3. 挂单建议（recommendations）：
   - 已挂订单调整（orders）：
     - 对每个挂单提供以下信息：
       ```json
       {
           "order_id": "订单编号",
           "pair": "交易对名称",
           "type": "buy 或 sell",
           "price": "当前挂单价格",
           "volume": "挂单数量",
           "action": "hold / cancel / modify",
           "reasoning": "调整建议的逻辑依据",
           "stop_loss": "止损价（动态设置，短线：1-2 倍 ATR；中长线：2-5 倍 ATR）",
           "take_profit": "止盈价（动态设置，短线：2-3 倍 ATR；中长线：3-5 倍 ATR）"
       }
       ```
     - 说明每个挂单的操作逻辑，例如趋势支持、关键价位接近或波动性变化。

   - 新增挂单建议（new_orders）：
     - 提供具体的新挂单建议，字段格式如下：
       ```json
       {
           "pair": "交易对名称",
           "type": "buy 或 sell",
           "price": "挂单价格",
           "volume": "挂单数量",
           "action": "create",
           "reasoning": "新增挂单的逻辑依据（如：突破信号或支撑反弹）",
           "condition": "触发条件（如 RSI 超买/超卖，或价格突破支撑/阻力位）",
           "stop_loss": "止损价（参考 ATR 或支撑位下方动态设置）",
           "take_profit": "止盈价（参考 ATR 或阻力位上方动态设置）",
           "risk_assessment": {
               "risk_level": "低 / 中 / 高",
               "atr_range": "ATR 范围，用于动态调整挂单范围",
               "estimated_drawdown": "预计回撤比例"
           },
           "expiry_time": "挂单有效时间（如 24 小时或其他时限）",
           "dynamic_price_range": "动态价格范围（如基于 ATR ±10%）"
       }
       ```

4. 逻辑与动态调整：
   - 挂单动态调整：
     - 确保挂单范围与市场波动性相关联，例如：挂单价格设置为支撑/阻力 ±(ATR 的 50%-100%)。
     - 动态止损和止盈设置：
       - 短线交易：止损 = 当前价格 - (1-2 倍 ATR)，止盈 = 当前价格 + (2-3 倍 ATR)。
       - 中长线交易：止损 = 当前价格 - (2-5 倍 ATR)，止盈 = 当前价格 + (3-5 倍 ATR)。
   - 风险控制：
     - 根据账户流动性、未实现盈亏和市场波动性，评估每个挂单的风险等级，并限制单笔挂单的风险暴露。

5. 输出注意事项：
   - 层次清晰：先市场分析，后挂单调整，最后新增挂单建议。
   - 详略得当：逻辑解释应清楚，但避免冗长，JSON 字段内容简洁明了。
   - 错误处理：如果数据不足（如长期趋势数据为空），需在字段中标明 "N/A" 或 "数据不足"。
"""
